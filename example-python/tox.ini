[base]
# set the python package name for use in other sections
name = example

[tox]
# 3.1.0 required for ignore_basepython_conflict
minversion = 3.1.0

# always use the python version specified in the environment name
ignore_basepython_conflict = true

# set which envs are run when tox is used with no args (e.g. from PyCharm)
envlist = test, build, lint

[testenv]
extras = test
allowlist_externals = poetry
commands_pre =
    poetry install --no-root --with lint,test
commands =
    coverage run -m --source {[base]name} --data-file=coverage_reports/.coverage --omit tests/* pytest
    coverage xml --data-file=coverage_reports/.coverage -o coverage_reports/coverage.xml
    coverage report --data-file=coverage_reports/.coverage -m

[testenv:lint]
allowlist_externals = poetry
deps =
    ruff>=0.7.3,<1.0.0
commands =
    ruff check --fix {[base]name}
    ruff check --fix tests

[testenv:type]
allowlist_externals = poetry
extras =
deps =
    mypy<=1.13.0,<2.0.0
commands =
    mypy example
    mypy tests

[testenv:build]
allowlist_externals = poetry
commands_pre =
    poetry install --no-root --with build
commands =
    poetry build
    twine check dist/*
